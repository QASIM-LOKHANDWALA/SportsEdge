<script>
  document.addEventListener("DOMContentLoaded", function () {
    const formFields = document.querySelectorAll(".form-control");

    formFields.forEach((field) => {
      field.classList.add("form-control");
      if (field.required) {
        field.classList.add("required");
      }

      field.addEventListener("input", function () {
        const errorContainer = field.nextElementSibling;
        if (errorContainer && errorContainer.classList.contains("errorlist")) {
          errorContainer.style.display = field.checkValidity() ? "none" : "block";
        }
        field.classList.toggle("is-invalid", !field.checkValidity());
        field.classList.toggle("is-valid", field.checkValidity());
      });
    });

    const passwordField = document.querySelector('input[type="password"]');
    if (passwordField) {
      const strengthIndicator = document.createElement("div");
      strengthIndicator.className = "password-strength";
      passwordField.parentNode.appendChild(strengthIndicator);

      passwordField.addEventListener("input", function () {
        const password = passwordField.value;
        const strength = getPasswordStrength(password);

        strengthIndicator.textContent = `Strength: ${strength.level}`;
        strengthIndicator.style.color = strength.color;

        passwordField.classList.toggle("is-valid", strength.isStrong);
        passwordField.classList.toggle("is-invalid", !strength.isStrong);
      });

      function getPasswordStrength(password) {
        let score = 0;
        if (password.length >= 8) score++;
        if (/[A-Z]/.test(password)) score++;
        if (/[a-z]/.test(password)) score++;
        if (/\d/.test(password)) score++;
        if (/[@$!%*?&#]/.test(password)) score++;

        if (score === 5) {
          return { level: "Strong", color: "green", isStrong: true };
        } else if (score >= 3) {
          return { level: "Medium", color: "orange", isStrong: false };
        } else {
          return { level: "Weak", color: "red", isStrong: false };
        }
      }
    }

    const form = document.querySelector("form.needs-validation");
    if (form) {
      form.addEventListener("submit", function (event) {
        let isValid = true;

        formFields.forEach((field) => {
          if (!field.checkValidity()) {
            isValid = false;
            field.classList.add("is-invalid");
          } else {
            field.classList.remove("is-invalid");
            field.classList.add("is-valid");
          }
        });

        if (!isValid) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add("was-validated");
      });
    }
  });
</script>
